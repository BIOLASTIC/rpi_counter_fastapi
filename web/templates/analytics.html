{% extends "base.html" %}

{% block content %}
<style>
    .kpi-card { text-align: center; }
    .kpi-value { font-size: 2.5rem; font-weight: 700; color: #0d6efd; }
    .kpi-label { font-size: 1rem; color: #6c757d; }
    .chart-container { position: relative; height: 350px; width: 100%; }
</style>

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Analytics Dashboard</h1>
    </div>

    <!-- Filter Card -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-2 align-items-end">
                <div class="col-lg-2 col-md-4"><label for="start-date" class="form-label">Start Date</label><input type="datetime-local" id="start-date" class="form-control"></div>
                <div class="col-lg-2 col-md-4"><label for="end-date" class="form-label">End Date</label><input type="datetime-local" id="end-date" class="form-control"></div>
                <div class="col-lg-2 col-md-4"><label for="operator-filter" class="form-label">Operator</label><select id="operator-filter" class="form-select"><option value="">All</option></select></div>
                <div class="col-lg-2 col-md-4"><label for="product-filter" class="form-label">Product</label><select id="product-filter" class="form-select"><option value="">All</option></select></div>
                <div class="col-lg-2 col-md-4">
                    <label class="form-label">Quick Filters</label>
                    <div class="btn-group w-100">
                        <button class="btn btn-outline-secondary" data-range="today">Today</button>
                        <button class="btn btn-outline-secondary" data-range="week">This Week</button>
                        <button class="btn btn-outline-secondary" data-range="month">This Month</button>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 d-flex">
                    <button class="btn btn-primary w-100 me-2" id="filter-btn" title="Apply Filter"><i class="bi bi-funnel-fill"></i></button>
                    <button class="btn btn-success w-100" id="export-btn" title="Export to CSV"><i class="bi bi-file-earmark-spreadsheet-fill"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loader" class="text-center my-5" style="display: none;">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Crunching the numbers...</p>
    </div>

    <!-- Analytics Content Area -->
    <div id="analytics-content" style="visibility: hidden;">
        <!-- KPIs Row -->
        <div class="row g-4 mb-4">
            <div class="col-md-2 col-4"><div class="card h-100"><div class="card-body kpi-card"><div class="kpi-value" id="kpi-total-items">--</div><div class="kpi-label">Items Detected</div></div></div></div>
            <div class="col-md-2 col-4"><div class="card h-100"><div class="card-body kpi-card"><div class="kpi-value" id="kpi-total-runs">--</div><div class="kpi-label">Total Runs</div></div></div></div>
            <div class="col-md-2 col-4"><div class="card h-100"><div class="card-body kpi-card"><div class="kpi-value" id="kpi-completed-runs" style="color: #198754;">--</div><div class="kpi-label">Completed</div></div></div></div>
            <div class="col-md-2 col-4"><div class="card h-100"><div class="card-body kpi-card"><div class="kpi-value" id="kpi-failed-runs" style="color: #dc3545;">--</div><div class="kpi-label">Failed</div></div></div></div>
            <div class="col-md-2 col-4"><div class="card h-100"><div class="card-body kpi-card"><div class="kpi-value" id="kpi-aborted-runs" style="color: #ffc107;">--</div><div class="kpi-label">Aborted</div></div></div></div>
            <div class="col-md-2 col-4"><div class="card h-100"><div class="card-body kpi-card"><div class="kpi-value" id="kpi-pass-rate" style="color: #198754;">--%</div><div class="kpi-label">Quality Pass Rate</div></div></div></div>
        </div>
        
        <!-- OEE-Lite Row -->
        <div class="row g-4 mb-4">
            <div class="col-md-4"><div class="card h-100"><div class="card-body kpi-card"><div class="kpi-value" id="oee-availability">--%</div><div class="kpi-label">Availability (Uptime)</div></div></div></div>
            <div class="col-md-4"><div class="card h-100"><div class="card-body kpi-card"><div class="kpi-value" id="oee-performance">--</div><div class="kpi-label">Items per Hour</div></div></div></div>
            <div class="col-md-4"><div class="card h-100"><div class="card-body"><div class="chart-container" style="height: 150px;"><canvas id="downtime-chart"></canvas></div></div></div></div>
        </div>

        <!-- Trend Chart Row -->
        <div class="row g-4 mb-4">
            <div class="col-12"><div class="card"><div class="card-header">Daily Performance Trend</div><div class="card-body"><div class="chart-container"><canvas id="daily-trend-chart"></canvas></div></div></div></div>
        </div>

        <!-- Charts Row -->
        <div class="row g-4 mb-4">
            <div class="col-lg-8"><div class="card"><div class="card-header">Hourly Throughput</div><div class="card-body"><div class="chart-container"><canvas id="hourly-chart"></canvas></div></div></div></div>
            <div class="col-lg-4"><div class="card"><div class="card-header">Product Mix</div><div class="card-body"><div class="chart-container"><canvas id="product-mix-chart"></canvas></div></div></div></div>
        </div>

        <!-- Top Lists Row -->
        <div class="row g-4">
            <div class="col-lg-6"><div class="card"><div class="card-header">Top 5 Products by Volume</div><div class="card-body"><table class="table" id="top-products-table"><tbody></tbody></table></div></div></div>
            <div class="col-lg-6"><div class="card"><div class="card-header">Top 5 Defects by Frequency</div><div class="card-body"><table class="table" id="top-defects-table"><tbody></tbody></table></div></div></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/analytics.js?v=2.0"></script>
{% endblock %}