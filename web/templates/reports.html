{% extends "base.html" %}

{% block content %}
<style>
    .report-card {
        background-color: #fff;
        border-radius: 0.75rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        padding: 2rem;
        margin-bottom: 1.5rem;
    }
    .report-card h3 {
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 0.75rem;
        margin-bottom: 1.5rem;
        font-weight: 600;
    }
    .stat-item {
        text-align: center;
    }
    .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #0d6efd;
    }
    .stat-label {
        font-size: 1rem;
        color: #6c757d;
        font-weight: 500;
    }
</style>

<div class="container-fluid">
    <h1 class="mb-4">Production Reports</h1>

    <!-- Filter Card -->
    <div class="report-card">
        <h3>Filter Report Data</h3>
        <form id="report-filter-form" class="row g-3 align-items-end">
            <div class="col-md-4">
                <label for="filter-start-date" class="form-label">Start Date</label>
                <input type="datetime-local" id="filter-start-date" class="form-control">
            </div>
            <div class="col-md-4">
                <label for="filter-end-date" class="form-label">End Date</label>
                <input type="datetime-local" id="filter-end-date" class="form-control">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Generate Report</button>
            </div>
            <div class="col-md-2">
                <button type="button" id="reset-filter-btn" class="btn btn-secondary w-100">Clear</button>
            </div>
        </form>
    </div>

    <!-- Summary Card -->
    <div class="report-card">
        <h3>Summary <span class="fs-6 text-muted" id="report-period-display"></span></h3>
        <div id="report-summary-content">
            <div class="row g-4">
                <div class="col-md-3 col-6 stat-item">
                    <div class="stat-value" id="total-runs">--</div>
                    <div class="stat-label">Total Runs</div>
                </div>
                <div class="col-md-3 col-6 stat-item">
                    <div class="stat-value" id="total-detections">--</div>
                    <div class="stat-label">Total Items Detected</div>
                </div>
                <div class="col-md-2 col-4 stat-item">
                    <div class="stat-value" id="completed-runs" style="color: #198754;">--</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="col-md-2 col-4 stat-item">
                    <div class="stat-value" id="failed-runs" style="color: #dc3545;">--</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="col-md-2 col-4 stat-item">
                    <div class="stat-value" id="aborted-runs" style="color: #ffc107;">--</div>
                    <div class="stat-label">Aborted</div>
                </div>
            </div>
        </div>
        <div id="report-loading-state" class="text-center" style="display: none;">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Generating report...</p>
        </div>
    </div>
    
    <!-- THIS IS THE RESTORED FEATURE: Detailed Run Logs Card -->
    <div class="report-card">
        <h3>Detailed Run Logs</h3>
        <div class="table-responsive">
            <table class="table table-hover small">
                <thead>
                    <tr>
                        <th>Start Time (UTC)</th>
                        <th>End Time (UTC)</th>
                        <th>Status</th>
                        <th>Batch Code</th>
                        <th>Product</th>
                        <th>Operator</th>
                        <th class="text-end">Detections</th>
                    </tr>
                </thead>
                <tbody id="report-history-table-body">
                    <!-- JavaScript will populate this table -->
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<!-- The version number is bumped to ensure browsers don't use a cached (old) version -->
<script src="/static/js/reports.js?v=1.3"></script>
{% endblock %}