# ============================================================================
# Box Counter System Environment Configuration - COMPLETE WORKING VERSION
# This configuration fixes the video streaming issue with proper camera settings
# ============================================================================

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================
APP_ENV=development
LOGGING_VERBOSE_LOGGING=false

# ============================================================================
# SERVER CONFIGURATION  
# ============================================================================
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
SERVER_SECRET_KEY=your-super-secret-key-change-this-in-production-min-32-chars

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# CRITICAL: No quotes around database URL to prevent parsing errors
DATABASE_URL=sqlite+aiosqlite:///./data/box_counter.db

# ============================================================================
# SECURITY SETTINGS
# ============================================================================
SECURITY_API_KEY=your-api-key-for-emergency-endpoints-change-this

# ============================================================================
# CAMERA CONFIGURATION - RAW RGB FORMAT (FIXES VIDEO STREAMING)
# ============================================================================
CAMERA_CAMERA_WIDTH=1280
CAMERA_CAMERA_HEIGHT=720
CAMERA_FRAMERATE=30

# WORKING: Valid AWB mode and color settings
# Only supported AWB modes: auto, incandescent, tungsten, fluorescent, daylight, cloudy, shade
CAMERA_AWB_MODE=auto
CAMERA_AWB_GAINS=1.5,1.2
CAMERA_EXPOSURE_TIME=33000
CAMERA_ANALOG_GAIN=1.0
CAMERA_SATURATION=0
CAMERA_CONTRAST=0
CAMERA_BRIGHTNESS=0
CAMERA_JPEG_QUALITY=90

# Stream Consistency Settings
CAMERA_COLOR_CORRECTION=enabled
CAMERA_COLOR_TEMP=5500

# ============================================================================
# AI HAT CONFIGURATION
# ============================================================================
AI_HAT_ENABLED=true
AI_HAT_MODEL_PATH=yolov8m.hef
AI_HAT_CONFIDENCE_THRESHOLD=0.5

# Hailo Monitoring Configuration (FIXES MONITORING)
HAILO_MONITOR_ENABLED=true
HAILO_MONITOR=1

# ============================================================================
# GPIO CONFIGURATION  
# ============================================================================
GPIO_PIN_CONVEYOR_RELAY=26
GPIO_PIN_GATE_RELAY=22
GPIO_PIN_LED_GREEN=27
GPIO_PIN_LED_RED=23
GPIO_PIN_BUZZER=24
GPIO_PIN_CAMERA_LIGHT=6

# ============================================================================
# SENSORS CONFIGURATION
# ============================================================================
SENSORS_ENTRY_CHANNEL=1
SENSORS_EXIT_CHANNEL=2
SENSORS_POLLING_INTERVAL_MS=50

# ============================================================================
# MODBUS CONFIGURATION
# ============================================================================
MODBUS_PORT=/dev/ttyUSB0
MODBUS_BAUDRATE=9600
MODBUS_SLAVE_ID=1
MODBUS_TIMEOUT=1.0

# Output Mapping (matches your system from logs)
MODBUS_OUTPUT_CONVEYOR=0
MODBUS_OUTPUT_GATE=1
MODBUS_OUTPUT_DIVERTER=2
MODBUS_OUTPUT_LED_GREEN=3
MODBUS_OUTPUT_LED_RED=4
MODBUS_OUTPUT_CAMERA_LIGHT=5
MODBUS_OUTPUT_BUZZER=6

# ============================================================================
# ORCHESTRATION & TIMING CONFIGURATION
# ============================================================================
ORCHESTRATION_POST_BATCH_DELAY_SEC=5
ORCHESTRATION_DETECTION_TIMEOUT_SEC=30
ORCHESTRATION_BATCH_SIZE=10

DETECTION_BASE_TRAVEL_TIME_SEC=2.0
DETECTION_SENSOR_DEBOUNCE_MS=100
DETECTION_STATE_TIMEOUT_SEC=10

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# Redis Key Patterns
REDIS_KEYS_AI_HEALTH_KEY=ai:health
REDIS_KEYS_AI_LAST_DETECTION_RESULT_KEY=ai:detection:last
REDIS_KEYS_SYSTEM_STATUS_KEY=system:status
REDIS_KEYS_BATCH_STATUS_KEY=batch:status

# Redis Channels (CRITICAL FOR VIDEO STREAMING)
REDIS_CHANNELS_CAMERA_RAW=camera:frames:rpi
REDIS_CHANNELS_AI_STREAM=ai_stream:frames:rpi
REDIS_CHANNELS_NOTIFICATIONS=notifications
REDIS_CHANNELS_WEBSOCKET_BROADCAST=websocket:broadcast

# ============================================================================
# PERFORMANCE & MONITORING
# ============================================================================
FRAME_BUFFER_SIZE=10
FRAME_DROP_THRESHOLD=5
PROCESSING_TIMEOUT_SEC=5

STATUS_UPDATE_INTERVAL_SEC=1
HEALTH_CHECK_INTERVAL_SEC=5
METRICS_COLLECTION_INTERVAL_SEC=30

# ============================================================================
# DEVELOPMENT & DEBUG SETTINGS
# ============================================================================
DEBUG_FRAME_LOGGING=false
DEBUG_SENSOR_LOGGING=false
DEBUG_HAILO_VERBOSE=false
DEBUG_SAVE_DETECTION_IMAGES=false

SIMULATION_MODE=false
SIMULATION_SENSOR_TRIGGER_INTERVAL=5

# ============================================================================
# SYSTEM INTEGRATION
# ============================================================================
CAMERA_ACTIVE_SOURCES=rpi
SYSTEM_ARCHITECTURE=AI_HAT_Pipeline

ENABLE_MODBUS_CONTROLLER=true
ENABLE_GPIO_CONTROLLER=true
ENABLE_CAMERA_SERVICE=true
ENABLE_AI_DETECTION=true
ENABLE_WEB_INTERFACE=true
ENABLE_WEBSOCKET_STREAMING=true

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_LEVEL=INFO
LOG_FILE_PATH=./logs/box_counter.log
LOG_MAX_FILE_SIZE_MB=10
LOG_BACKUP_COUNT=5
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s

# ============================================================================
# NETWORK & CONNECTIVITY
# ============================================================================
NETWORK_INTERFACE=eth0
NETWORK_BROADCAST_PORT=8001

HTTP_TIMEOUT_SEC=30
WEBSOCKET_TIMEOUT_SEC=60
CAMERA_STREAM_TIMEOUT_SEC=10

# ============================================================================
# BACKUP & RECOVERY
# ============================================================================
DATABASE_BACKUP_ENABLED=true
DATABASE_BACKUP_INTERVAL_HOURS=24
DATABASE_BACKUP_RETENTION_DAYS=7
DATABASE_BACKUP_PATH=./backups

CONFIG_BACKUP_ENABLED=true
CONFIG_BACKUP_PATH=./config_backups

# ============================================================================
# ADVANCED HAILO SETTINGS
# ============================================================================
HAILORT_LOG_LEVEL=info
HAILORT_SCHEDULER_TIMEOUT=5000
HAILORT_VDEVICE_GROUP_ID=default

HAILO_BATCH_SIZE=1
HAILO_POWER_MODE=performance
HAILO_MEASURE_LATENCY=false

HAILO_MULTI_PROCESS_SERVICE=false
HAILO_SERVICE_TIMEOUT=30

# ============================================================================
# QUALITY CONTROL
# ============================================================================
IMAGE_QUALITY_CHECK=true
MIN_IMAGE_QUALITY_SCORE=0.7
IMAGE_BLUR_THRESHOLD=100

MIN_DETECTION_CONFIDENCE=0.5
MAX_DETECTIONS_PER_FRAME=10
DETECTION_NMS_THRESHOLD=0.4

HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_TIMEOUT_SEC=10
HEALTH_CHECK_RETRY_COUNT=3

# ============================================================================
# MAINTENANCE & DIAGNOSTICS
# ============================================================================
AUTO_CLEANUP_ENABLED=true
AUTO_CLEANUP_INTERVAL_HOURS=24
TEMP_FILES_RETENTION_DAYS=3

DIAGNOSTICS_ENABLED=true
DIAGNOSTICS_COLLECTION_INTERVAL_MIN=60
DIAGNOSTICS_RETENTION_DAYS=30

PROFILING_ENABLED=false
PROFILING_OUTPUT_PATH=./profiling
PROFILING_SAMPLE_RATE=0.1

# ============================================================================
# VIDEO STREAMING SPECIFIC SETTINGS (NEW - FIXES THE ISSUE)
# ============================================================================
# Video format settings for proper streaming
VIDEO_FORMAT=RGB
VIDEO_CODEC=rgb
VIDEO_CONTAINER=raw

# Frame processing settings
FRAME_VALIDATION_ENABLED=true
FRAME_SIZE_VALIDATION=true
FRAME_TIMEOUT_MS=1000

# Streaming performance
STREAM_BUFFER_SIZE=3
STREAM_QUEUE_SIZE=10
STREAM_DROP_FRAMES_ON_DELAY=true

# Color processing
COLOR_SPACE_CONVERSION=RGB_TO_BGR
COLOR_CORRECTION_ENABLED=true
GAMMA_CORRECTION=1.0

# Publisher settings
PUBLISHER_RETRY_COUNT=3
PUBLISHER_TIMEOUT_SEC=5
PUBLISHER_BATCH_SIZE=1

# Redis streaming settings
REDIS_PUBLISH_TIMEOUT=1
REDIS_CONNECTION_POOL_SIZE=10
REDIS_RETRY_ON_TIMEOUT=true
