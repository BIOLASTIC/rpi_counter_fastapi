# ===========================================================================
# ==             RPI BOX COUNTER SYSTEM - CONFIGURATION V12.0              ==
# ===========================================================================

# --- Application Environment ---
# Set to "development" for debug endpoints, "production" for deployment.
APP_ENV=development

# --- Localization & Logging ---
TIMEZONE=Asia/Kolkata
# Set to "true" to see detailed state machine and event logs in the console.
LOGGING_VERBOSE_LOGGING=true

# --- Project & Server ---
PROJECT_NAME="Raspberry Pi 5 Box Counter System - Hybrid AI"
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
# IMPORTANT: Generate a new, long, random string (e.g., `openssl rand -hex 32`)
SERVER_SECRET_KEY="8d062b3e4f15c210b28d69a31fcda64fc0c210d3fe864d626fd40bbc486a1fa9"

# --- Security ---
# A static API key for protected endpoints like Emergency Stop.
SECURITY_API_KEY="your_secret_api_key_here"
# IMPORTANT: Generate a new, long, random string for JWT security
SECURITY_JWT_SECRET_KEY="a_very_secret_key_that_is_at_least_32_chars_long_for_jwt"

# --- Database ---
# For production, consider using PostgreSQL instead of SQLite.
DB_URL="sqlite+aiosqlite:///./data/box_counter.db"
DB_ECHO=false

# --- External AI Service URLs ---
AI_API_BASE_URL="http://192.168.88.97:3001"
LLM_API_BASE_URL="http://192.168.88.81:8000"
TTS_API_BASE_URL="http://localhost:5003"
REDIS_HOST="localhost"
REDIS_PORT=6379

# ===========================================================================
# ==                       AI & AUDIO STRATEGY                               ==
# ===========================================================================
# These settings define the default behavior and can be changed live via the UI.

# --- Master Toggles & Global Settings ---
AI_STRATEGY_YOLO_ENABLED=True
AI_STRATEGY_LLM_ENABLED=True
AI_STRATEGY_TTS_ENABLED=True
AI_STRATEGY_LANGUAGE="en" # Default language for LLM & TTS

# --- Real-Time (Per-Item) Strategy ---
AI_STRATEGY_REALTIME_TTS_ENGINE="mac"       # Fastest option: "mac", higher quality: "xtts"
AI_STRATEGY_ALERT_ON_PASS=False             # Set to true to announce every accepted item
AI_STRATEGY_ALERT_ON_REJECT=True            # Announce every failed item
AI_STRATEGY_PASS_TEMPLATE="Item {count} accepted."
AI_STRATEGY_REJECT_TEMPLATE="Item {count} rejected. Reason: {defects}."
AI_STRATEGY_LLM_ITEM_ANALYSIS_ENABLED=True  # Enable background LLM analysis for each item
AI_STRATEGY_LLM_ITEM_WORD_COUNT=25          # Target word count for the per-item LLM summary

# --- Post-Batch (Summary) Strategy ---
AI_STRATEGY_SUMMARY_TTS_ENGINE="parler"     # High-quality engine: "parler" or "xtts"
AI_STRATEGY_SUMMARY_LLM_MODEL="high_quality" # "high_quality" for better summaries, "realtime" for faster ones
AI_STRATEGY_LLM_SUMMARY_WORD_COUNT=75       # Target word count for the detailed batch report
AI_STRATEGY_TTS_SUMMARY_CHUNK_COUNT=4       # How many audio segments to split the summary into
AI_STRATEGY_BATCH_COMPLETE_TEMPLATE="Batch {batch_id} for {product_name} complete. Total Items: {total_items}, Rejects: {reject_count}."
AI_STRATEGY_NEXT_BATCH_TEMPLATE="Next run starting in {countdown}."
AI_STRATEGY_LLM_PROMPT_TEMPLATE="You are a helpful assistant on a factory floor. Summarize the following production batch results with an encouraging but honest tone for the operator. The top defect was {top_defect}. Batch details: {batch_data}"

# ===========================================================================
# ==                     HARDWARE & PHYSICAL SYSTEM                          ==
# ===========================================================================

# --- Modbus RTU Communication (RS485) ---
MODBUS_PORT=/dev/ttyUSB0
MODBUS_BAUDRATE=9600
MODBUS_TIMEOUT_SEC=0.5
MODBUS_POLLING_MS=50
MODBUS_DEVICE_ADDRESS_INPUTS=1  # Slave ID for the USR-IO4040 (Inputs)
MODBUS_DEVICE_ADDRESS_OUTPUTS=2 # Slave ID for the USR-IO8000 (Outputs)

# --- Sensor Channel Mapping (on USR-IO4040) ---
# Physical channel number (1-4) on the input module.
SENSORS_ENTRY_CHANNEL=2
SENSORS_EXIT_CHANNEL=1

# --- Output Channel Mapping (on USR-IO8000) ---
# Maps logical names to the 0-indexed coil address (RO1=0, RO2=1, etc.)
OUTPUTS_CONVEYOR=4
OUTPUTS_GATE=0
OUTPUTS_DIVERTER=0
OUTPUTS_LED_GREEN=3
OUTPUTS_LED_RED=3
OUTPUTS_BUZZER=1
OUTPUTS_CAMERA_LIGHT=6
OUTPUTS_CAMERA_LIGHT_TWO=5

# --- Physical Conveyor System ---
CONVEYOR_SPEED_M_PER_SEC=0.5
CONVEYOR_CAMERA_TO_SORTER_DISTANCE_M=1.0
CONVEYOR_AUTO_STOP_DELAY_SEC=4
CONVEYOR_MAX_TRANSIT_TIME_SEC=45.0
ORCHESTRATION_POST_BATCH_DELAY_SEC=5 # Pause between looped batches

# --- Buzzer Alerts (Durations in Milliseconds) ---
BUZZER_MISMATCH_MS=500
BUZZER_MANUAL_TOGGLE_MS=200
BUZZER_LOOP_COMPLETE_MS=1000
BUZZER_EXIT_SENSOR_MS=150

# --- General Camera & UI Settings ---
CAMERA_MODE="rpi"  # Options: "rpi", "usb", "both", "none"
CAMERA_CAPTURES_DIR="web/static/captures"
CAMERA_TRIGGER_DELAY_MS=1500
UI_ANIMATION_TRANSIT_TIME_SEC=11

# --- RASPBERRY PI CAMERA SETTINGS ---
# Find this value with `libcamera-hello --list-cameras`
CAMERA_RPI_ID="/base/axi/pcie@1000120000/rp1/i2c@80000/imx219@10"
CAMERA_RPI_RESOLUTION_WIDTH=1280
CAMERA_RPI_RESOLUTION_HEIGHT=720
CAMERA_RPI_FPS=60
CAMERA_RPI_JPEG_QUALITY=100
CAMERA_RPI_SHUTTER_SPEED=0
CAMERA_RPI_ISO=0
CAMERA_RPI_MANUAL_FOCUS=0.0

# --- USB CAMERA SETTINGS ---
# Find this value with `v4l2-ctl --list-devices`
CAMERA_USB_DEVICE_INDEX=0
CAMERA_USB_RESOLUTION_WIDTH=1280
CAMERA_USB_RESOLUTION_HEIGHT=720
CAMERA_USB_FPS=30
CAMERA_USB_JPEG_QUALITY=100
CAMERA_USB_AUTOFOCUS=1
CAMERA_USB_BRIGHTNESS=128
CAMERA_USB_GAIN=250
CAMERA_USB_EXPOSURE=-7